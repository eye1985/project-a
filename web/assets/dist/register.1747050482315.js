var I="sc",u="id",k="template-id",L="type",b="method",F="form-onerror",C="form-onsuccess",O="handler",a={formMethods:new Map,elements:new Map,handlers:new Map,state:new Map,getByType(n){let e=[];return this.elements.forEach(t=>{t.type===n&&e.push(t)}),e}},i=n=>`data-${I}-${n}`,$=n=>Array.from(n.querySelectorAll(`[${i(u)}]`)),E=n=>{let e=n.getAttribute(i(u));if(!e)throw new Error(`${E.name}: id is required`);if(a.elements.get(e))throw new Error(`${E.name}: id ${e} already exists`);a.elements.set(e,new g(n))},M=()=>{for(let n of a.handlers.keys())a.elements.forEach(e=>{if(e.handleName===n&&!e.isHandleApplied&&e.handleEvent){let t=a.handlers.get(n);if(!t)throw new Error(`${M.name}: handler ${n} not found`);let s=r=>{t(r,e,a)};e.ref.addEventListener(e.handleEvent,s),e.handlers.push(s),e.isHandleApplied=!0}})};var g=class n{id;type=null;handleName=null;handleEvent=null;isHandleApplied=!1;isTemplate=!1;ref;templateWrapperRef=null;handlers;constructor(e){let t=e.getAttribute(i(u));if(!t)throw new Error(`${n.name}: id is required`);let s=e.getAttribute(i(L));s&&(this.type=s);let r=e.getAttribute(`${i(O)}`);if(this.id=t,this.ref=e,this.handlers=[],r){let l=r.split(":");l[0]&&l[1]&&(this.handleEvent=l[0],this.handleName=l[1])}let c=this.ref.getAttribute(`${i(b)}`)&&this.ref.getAttribute("action");this.ref instanceof HTMLFormElement&&c?this.overrideSubmit(this.ref):this.ref instanceof HTMLTemplateElement&&(this.isTemplate=!0)}overrideSubmit=e=>{let t=async s=>{s.preventDefault();let r=e.getAttribute("action"),c=e.getAttribute(`${i(b)}`),l=e.getAttribute(`${i(C)}`),m=e.getAttribute(`${i(F)}`);if(!c||!r){console.warn(`${this.overrideSubmit.name}: action or method is missing, skipping`);return}let N=["POST","PUT","DELETE","PATCH"],y=c.toUpperCase();if(!N.includes(y)){console.warn(`${this.overrideSubmit.name}: method ${c} is not supported, skipping`);return}let h={};for(let o of e.querySelectorAll("[name]"))if(o instanceof HTMLInputElement){if(!isNaN(Number(o.value))){if(Number.isInteger(o.value)){h[o.name]=parseInt(o.value);continue}h[o.name]=parseFloat(o.value);continue}h[o.name]=o.value}try{let o=await fetch(r,{method:y,body:JSON.stringify(h),credentials:"include",headers:{"Content-Type":"application/json"}});if(!o.ok){let d=await o.text();if(!m){console.error("error: "+d);return}let f=a.formMethods.get(m);if(!f)return;f(d);return}if(l){let f=o.headers.get("content-type")?.includes("application/json")?await o.json():null,A=a.formMethods.get(l);if(!A)throw new Error(`${this.overrideSubmit.name}: success handler ${l} not found`);A(f)}}catch(o){console.error(o.message)}};e.addEventListener("submit",t),this.handlers.push(t)};insertTemplateInto=(e,t)=>{let s=e instanceof n?e.ref:e;if(!this.isTemplate)throw new Error(`${this.insertTemplateInto.name}: element is not a template`);if(!s)throw new Error(`${this.insertTemplateInto.name}: target is required`);let r=document.createElement("div"),l=this.ref.content.cloneNode(!0);r.appendChild(l),r.setAttribute(i(k),this.id),t&&t.classNames&&t.classNames.forEach(m=>{r.classList.add(m)}),this.templateWrapperRef=r,t&&t.clearBeforeInsert&&(w(s),s.innerHTML=""),s.appendChild(r),T(r),M()};remove(){let e=this.isTemplate?this.templateWrapperRef:this.ref;e&&(this.handlers.forEach(t=>{this.handleEvent&&e.removeEventListener(this.handleEvent,t)}),w(e),e.remove())}},T=n=>{$(n).forEach(t=>{E(t)})},w=n=>{$(n).forEach(t=>{let s=t.getAttribute(i(u));if(!s)throw new Error(`${w.name}: id is not found, you somehow added a non custom element into the store`);let r=a.elements.get(s);r&&(r.handlers.forEach(c=>{r.handleEvent&&r.ref.removeEventListener(r.handleEvent,c)}),r.ref.remove()),a.elements.delete(s)})};var v=n=>{let e=a.elements.get(n);return e||null};var p=(n,e)=>{if(a.formMethods.get(n))throw new Error(`${p.name}: method ${n} already exists`);a.formMethods.set(n,e)},S=n=>{let e=document.cookie.split(";").map(t=>t.trim()).find(t=>t.startsWith(n+"="))?.split("=");return e&&e.length>1?{key:e[0],value:e[1]}:null};var H=(n,e)=>{let t=v("toast");if(t){let s=t.ref.content.querySelector("p");if(!s)throw new Error("p not found");s.innerText=n,t.insertTemplateInto(document.body),e&&setTimeout(()=>{t.remove()},e)}};T(document.body);p("onerror",n=>{H(n,2e3)});p("onsuccess",n=>{console.log(n);let e=document.querySelector(".layout");if(!e)return;let t=v("emailSent");t&&t.insertTemplateInto(e,{clearBeforeInsert:!0,classNames:["layout-item"]})});var x=S("flash");x&&H(x.value+"",2e3);
