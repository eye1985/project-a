var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var k=(t,e)=>{for(var n in e)g(t,n,{get:e[n],enumerable:!0})},I=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of S(e))!L.call(t,r)&&r!==n&&g(t,r,{get:()=>e[r],enumerable:!(s=N(e,r))||s.enumerable});return t};var F=t=>I(g({},"__esModule",{value:!0}),t);var B={};k(B,{CustomElement:()=>u,addFormMethod:()=>H,addFromTarget:()=>b,addHandler:()=>M,deleteAllCookies:()=>_,deleteAllFromTarget:()=>p,getCookie:()=>U,getElement:()=>J,isTemplate:()=>W,state:()=>j});module.exports=F(B);var O="sc",E="id",R="template-id",C="type",$="method",D="form-onerror",P="form-onsuccess",q="handler",o={formMethods:new Map,elements:new Map,handlers:new Map,state:new Map,getByType(t){let e=[];return this.elements.forEach(n=>{n.type===t&&e.push(n)}),e}},a=t=>`data-${O}-${t}`,y=t=>Array.from(t.querySelectorAll(`[${a(E)}]`)),w=t=>{let e=t.getAttribute(a(E));if(!e)throw new Error(`${w.name}: id is required`);if(o.elements.get(e))throw new Error(`${w.name}: id ${e} already exists`);o.elements.set(e,new u(t))},v=()=>{for(let t of o.handlers.keys())o.elements.forEach(e=>{if(e.handleName===t&&!e.isHandleApplied&&e.handleEvent){let n=o.handlers.get(t);if(!n)throw new Error(`${v.name}: handler ${t} not found`);let s=r=>{n(r,e,o)};e.ref.addEventListener(e.handleEvent,s),e.handlers.push(s),e.isHandleApplied=!0}})},j={get(t){return o.state.get(t)},set(t,e){o.state.set(t,e)}},u=class t{id;type=null;handleName=null;handleEvent=null;isHandleApplied=!1;isTemplate=!1;ref;templateWrapperRef=null;handlers;constructor(e){let n=e.getAttribute(a(E));if(!n)throw new Error(`${t.name}: id is required`);let s=e.getAttribute(a(C));s&&(this.type=s);let r=e.getAttribute(`${a(q)}`);if(this.id=n,this.ref=e,this.handlers=[],r){let l=r.split(":");l[0]&&l[1]&&(this.handleEvent=l[0],this.handleName=l[1])}let c=this.ref.getAttribute(`${a($)}`)&&this.ref.getAttribute("action");this.ref instanceof HTMLFormElement&&c?this.overrideSubmit(this.ref):this.ref instanceof HTMLTemplateElement&&(this.isTemplate=!0)}overrideSubmit=e=>{let n=async s=>{s.preventDefault();let r=e.getAttribute("action"),c=e.getAttribute(`${a($)}`),l=e.getAttribute(`${a(P)}`),h=e.getAttribute(`${a(D)}`);if(!c||!r){console.warn(`${this.overrideSubmit.name}: action or method is missing, skipping`);return}let x=["POST","PUT","DELETE","PATCH"],T=c.toUpperCase();if(!x.includes(T)){console.warn(`${this.overrideSubmit.name}: method ${c} is not supported, skipping`);return}let m={};for(let i of e.querySelectorAll("[name]"))if(i instanceof HTMLInputElement){if(!isNaN(Number(i.value))){if(Number.isInteger(i.value)){m[i.name]=parseInt(i.value);continue}m[i.name]=parseFloat(i.value);continue}m[i.name]=i.value}try{let i=await fetch(r,{method:T,body:JSON.stringify(m),credentials:"include",headers:{"Content-Type":"application/json"}});if(!i.ok){let d=await i.text();if(!h){console.error("error: "+d);return}let f=o.formMethods.get(h);if(!f)return;f(d);return}if(l){let f=i.headers.get("content-type")?.includes("application/json")?await i.json():null,A=o.formMethods.get(l);if(!A)throw new Error(`${this.overrideSubmit.name}: success handler ${l} not found`);A(f)}}catch(i){console.error(i.message)}};e.addEventListener("submit",n),this.handlers.push(n)};insertTemplateInto=(e,n)=>{let s=e instanceof t?e.ref:e;if(!this.isTemplate)throw new Error(`${this.insertTemplateInto.name}: element is not a template`);if(!s)throw new Error(`${this.insertTemplateInto.name}: target is required`);let r=document.createElement("div"),l=this.ref.content.cloneNode(!0);r.appendChild(l),r.setAttribute(a(R),this.id),n&&n.classNames&&n.classNames.forEach(h=>{r.classList.add(h)}),this.templateWrapperRef=r,n&&n.clearBeforeInsert&&(p(s),s.innerHTML=""),s.appendChild(r),b(r),v()};remove(){let e=this.isTemplate?this.templateWrapperRef:this.ref;e&&(this.handlers.forEach(n=>{this.handleEvent&&e.removeEventListener(this.handleEvent,n)}),p(e),e.remove())}},b=t=>{y(t).forEach(n=>{w(n)})},p=t=>{y(t).forEach(n=>{let s=n.getAttribute(a(E));if(!s)throw new Error(`${p.name}: id is not found, you somehow added a non custom element into the store`);let r=o.elements.get(s);r&&(r.handlers.forEach(c=>{r.handleEvent&&r.ref.removeEventListener(r.handleEvent,c)}),r.ref.remove()),o.elements.delete(s)})},W=t=>t instanceof HTMLTemplateElement,J=t=>{let e=o.elements.get(t);return e||null},M=(t,e)=>{if(o.handlers.get(t))throw new Error(`${M.name}: handler ${t} already exists`);o.handlers.set(t,e),v()},H=(t,e)=>{if(o.formMethods.get(t))throw new Error(`${H.name}: method ${t} already exists`);o.formMethods.set(t,e)},U=t=>{let e=document.cookie.split(";").map(n=>n.trim()).find(n=>n.startsWith(t+"="))?.split("=");return e&&e.length>1?{key:e[0],value:e[1]}:null},_=()=>{document.cookie="flash=; Max-Age=0; path=/;"};
